<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Perbandingan Warna Benang (Dengan Kamera)</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f3f4f6;
        padding: 20px;
    }
    .box {
        background: white;
        padding: 16px;
        border-radius: 10px;
        max-width: 420px;
        margin: auto;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    .color-preview {
        width: 100%;
        height: 90px;
        border-radius: 8px;
        margin-top: 8px;
    }
    button {
        padding: 10px;
        width: 100%;
        border: 0;
        background: #2563eb;
        color: white;
        border-radius: 8px;
        cursor: pointer;
        margin-top: 12px;
    }
    .cam-btn {
        background: #10b981;
        margin-top: 6px;
    }
</style>
</head>

<body>
<div class="box">
    <h3>Perbandingan Warna Cone Benang</h3>

    <!-- Foto Cone 1 -->
    <label>Foto Cone 1:</label>
    <input type="file" id="img1" accept="image/*">
    <input type="file" id="cam1" accept="image/*" capture="environment" class="cam-btn">

    <!-- Foto Cone 2 -->
    <label>Foto Cone 2:</label>
    <input type="file" id="img2" accept="image/*">
    <input type="file" id="cam2" accept="image/*" capture="environment" class="cam-btn">

    <button onclick="compareColors()">Bandingkan Warna</button>

    <h4>Hasil:</h4>

    <div>Warna Cone 1:</div>
    <div id="color1" class="color-preview"></div>
    <div id="hex1"></div>

    <br>

    <div>Warna Cone 2:</div>
    <div id="color2" class="color-preview"></div>
    <div id="hex2"></div>

    <h3 id="similarity"></h3>

    <canvas id="canvas" style="display:none;"></canvas>
</div>

<script>
// Ambil warna dominan
function getDominantColor(img) {
    return new Promise((resolve) => {
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        img.onload = function() {
            canvas.width = img.width;
            canvas.height = img.height;

            ctx.drawImage(img, 0, 0);

            const data = ctx.getImageData(0, 0, img.width, img.height).data;

            let r = 0, g = 0, b = 0, count = 0;

            // sampling pixel
            for (let i = 0; i < data.length; i += 40) {
                r += data[i];
                g += data[i+1];
                b += data[i+2];
                count++;
            }

            resolve({
                r: Math.round(r/count),
                g: Math.round(g/count),
                b: Math.round(b/count)
            });
        };
    });
}

// RGB ke Hex
function rgbToHex({r,g,b}) {
    return "#" + [r,g,b].map(x => x.toString(16).padStart(2, '0')).join("");
}

// Mengukur jarak warna
function colorDistance(c1, c2) {
    return Math.sqrt(
        (c1.r - c2.r)**2 +
        (c1.g - c2.g)**2 +
        (c1.b - c2.b)**2
    );
}

// Aksi utama
async function compareColors() {
    const f1 = document.getElementById("img1").files[0] || document.getElementById("cam1").files[0];
    const f2 = document.getElementById("img2").files[0] || document.getElementById("cam2").files[0];

    if (!f1 || !f2) return alert("Ambil atau upload 2 foto terlebih dahulu.");

    const img1 = new Image();
    const img2 = new Image();

    img1.src = URL.createObjectURL(f1);
    img2.src = URL.createObjectURL(f2);

    const color1 = await getDominantColor(img1);
    const color2 = await getDominantColor(img2);

    const hex1 = rgbToHex(color1);
    const hex2 = rgbToHex(color2);

    document.getElementById("color1").style.background = hex1;
    document.getElementById("color2").style.background = hex2;
    document.getElementById("hex1").innerHTML = hex1;
    document.getElementById("hex2").innerHTML = hex2;

    const diff = colorDistance(color1, color2);

    let percent = Math.max(0, 100 - (diff / 4));

    let status = "";
    if (percent > 90) status = "Sangat Mirip";
    else if (percent > 75) status = "Mirip";
    else if (percent > 55) status = "Cukup Mirip";
    else status = "Berbeda Jauh";

    document.getElementById("similarity").innerHTML =
        `Kemiripan: ${percent.toFixed(1)}% â€” <b>${status}</b>`;
}
</script>

</body>
</html>
